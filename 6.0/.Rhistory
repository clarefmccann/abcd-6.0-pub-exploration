# puberty_fu5 ~~ puberty_fu6
puberty  ~ 0*1
# puberty_bl  ~ 0*1
# puberty_fu1 ~ 0*1
# puberty_fu2 ~ 0*1
# puberty_fu3 ~ 0*1
# puberty_fu4 ~ 0*1
# puberty_fu5 ~ 0*1
# puberty_fu6 ~ 0*1
# fix residual variances to 1 for theta parameterization
peta_p ~~ 1*peta_p
petb_p ~~ 1*petb_p
petc_p ~~ 1*petc_p
petd_p ~~ 1*petd_p
pete_p ~~ 1*pete_p
# peta_p_bl  ~~ 1*peta_p_bl
# peta_p_fu1 ~~ 1*peta_p_fu1
# peta_p_fu2 ~~ 1*peta_p_fu2
# peta_p_fu3 ~~ 1*peta_p_fu3
# peta_p_fu4 ~~ 1*peta_p_fu4
# peta_p_fu5 ~~ 1*peta_p_fu5
# peta_p_fu6 ~~ 1*peta_p_fu6
#
# petb_p_bl  ~~ 1*petb_p_bl
# petb_p_fu1 ~~ 1*petb_p_fu1
# petb_p_fu2 ~~ 1*petb_p_fu2
# petb_p_fu3 ~~ 1*petb_p_fu3
# petb_p_fu4 ~~ 1*petb_p_fu4
# petb_p_fu5 ~~ 1*petb_p_fu5
# petb_p_fu6 ~~ 1*petb_p_fu6
#
# petc_p_bl  ~~ 1*petc_p_bl
# petc_p_fu1 ~~ 1*petc_p_fu1
# petc_p_fu2 ~~ 1*petc_p_fu2
# petc_p_fu3 ~~ 1*petc_p_fu3
# petc_p_fu4 ~~ 1*petc_p_fu4
# petc_p_fu5 ~~ 1*petc_p_fu5
# petc_p_fu6 ~~ 1*petc_p_fu6
#
# petd_p_bl  ~~ 1*petd_p_bl
# petd_p_fu1 ~~ 1*petd_p_fu1
# petd_p_fu2 ~~ 1*petd_p_fu2
# petd_p_fu3 ~~ 1*petd_p_fu3
# petd_p_fu4 ~~ 1*petd_p_fu4
# petd_p_fu5 ~~ 1*petd_p_fu5
# petd_p_fu6 ~~ 1*petd_p_fu6
#
# pete_p_bl  ~~ 1*pete_p_bl
# pete_p_fu1 ~~ 1*pete_p_fu1
# pete_p_fu2 ~~ 1*pete_p_fu2
# pete_p_fu3 ~~ 1*pete_p_fu3
# pete_p_fu4 ~~ 1*pete_p_fu4
# pete_p_fu5 ~~ 1*pete_p_fu5
# pete_p_fu6 ~~ 1*pete_p_fu6
#
'
fit_config_long <- cfa(
model_parent,
data = subset(model_both, sex == 1),
missing = "pairwise",
group = "wave",
parameterization = "theta",
ordered = p_items,
std.lv = TRUE
)
fit_config_long <- cfa(
model_parent,
data = subset(merged_both, sex == 1),
missing = "pairwise",
group = "wave",
parameterization = "theta",
ordered = p_items,
std.lv = TRUE
)
merged_wide_f <- merged_both_wide %>%
filter(sex == 1)
merged_wide_m <- merged_both_wide %>%
filter(sex == 0)
# define all your ordered variables once
ordered_vars_list <- c(
"peta_p_bl", "peta_p_fu1", "peta_p_fu2", "peta_p_fu3", "peta_p_fu4", "peta_p_fu5", "peta_p_fu6",
"petb_p_bl", "petb_p_fu1", "petb_p_fu2", "petb_p_fu3", "petb_p_fu4", "petb_p_fu5", "petb_p_fu6",
"petc_p_bl", "petc_p_fu1", "petc_p_fu2", "petc_p_fu3", "petc_p_fu4", "petc_p_fu5", "petc_p_fu6",
"petd_p_bl", "petd_p_fu1", "petd_p_fu2", "petd_p_fu3", "petd_p_fu4", "petd_p_fu5", "petd_p_fu6",
"pete_p_bl", "pete_p_fu1", "pete_p_fu2", "pete_p_fu3", "pete_p_fu4", "pete_p_fu5", "pete_p_fu6"
)
model_parent_config <- '
# factor loadings (all free)
puberty_bl =~ 1*peta_p_bl + petb_p_bl + petc_p_bl + petd_p_bl + pete_p_bl
puberty_fu1 =~ 1*peta_p_fu1 + petb_p_fu1 + petc_p_fu1 + petd_p_fu1 + pete_p_fu1
puberty_fu2 =~ 1*peta_p_fu2 + petb_p_fu2 + petc_p_fu2 + petd_p_fu2 + pete_p_fu2
puberty_fu3 =~ 1*peta_p_fu3 + petb_p_fu3 + petc_p_fu3 + petd_p_fu3 + pete_p_fu3
puberty_fu4 =~ 1*peta_p_fu4 + petb_p_fu4 + petc_p_fu4 + petd_p_fu4 + pete_p_fu4
puberty_fu5 =~ 1*peta_p_fu5 + petb_p_fu5 + petc_p_fu5 + petd_p_fu5 + pete_p_fu5
puberty_fu6 =~ 1*peta_p_fu6 + petb_p_fu6 + petc_p_fu6 + petd_p_fu6 + pete_p_fu6
# latent variances (fixed to 1 by std.lv=true) and covariances (all free)
puberty_bl ~~ puberty_bl
puberty_fu1 ~~ puberty_fu1
puberty_fu2 ~~ puberty_fu2
puberty_fu3 ~~ puberty_fu3
puberty_fu4 ~~ puberty_fu4
puberty_fu5 ~~ puberty_fu5
puberty_fu6 ~~ puberty_fu6
puberty_bl ~~ puberty_fu1 + puberty_fu2 + puberty_fu3 + puberty_fu4 + puberty_fu5 + puberty_fu6
puberty_fu1 ~~ puberty_fu2 + puberty_fu3 + puberty_fu4 + puberty_fu5 + puberty_fu6
puberty_fu2 ~~ puberty_fu3 + puberty_fu4 + puberty_fu5 + puberty_fu6
puberty_fu3 ~~ puberty_fu4 + puberty_fu5 + puberty_fu6
puberty_fu4 ~~ puberty_fu5 + puberty_fu6
puberty_fu5 ~~ puberty_fu6
# latent intercepts (fixed to 0)
puberty_bl  ~ 0*1
puberty_fu1 ~ 0*1
puberty_fu2 ~ 0*1
puberty_fu3 ~ 0*1
puberty_fu4 ~ 0*1
puberty_fu5 ~ 0*1
puberty_fu6 ~ 0*1
# residual variances (fixed to 1 for theta parameterization)
peta_p_bl ~~ 1*peta_p_bl; petb_p_bl ~~ 1*petb_p_bl; petc_p_bl ~~ 1*petc_p_bl; petd_p_bl ~~ 1*petd_p_bl; pete_p_bl ~~ 1*pete_p_bl
peta_p_fu1 ~~ 1*peta_p_fu1; petb_p_fu1 ~~ 1*petb_p_fu1; petc_p_fu1 ~~ 1*petc_p_fu1; petd_p_fu1 ~~ 1*petd_p_fu1; pete_p_fu1 ~~ 1*pete_p_fu1
peta_p_fu2 ~~ 1*peta_p_fu2; petb_p_fu2 ~~ 1*petb_p_fu2; petc_p_fu2 ~~ 1*petc_p_fu2; petd_p_fu2 ~~ 1*petd_p_fu2; pete_p_fu2 ~~ 1*pete_p_fu2
peta_p_fu3 ~~ 1*peta_p_fu3; petb_p_fu3 ~~ 1*petb_p_fu3; petc_p_fu3 ~~ 1*petc_p_fu3; petd_p_fu3 ~~ 1*petd_p_fu3; pete_p_fu3 ~~ 1*pete_p_fu3
peta_p_fu4 ~~ 1*peta_p_fu4; petb_p_fu4 ~~ 1*petb_p_fu4; petc_p_fu4 ~~ 1*petc_p_fu4; petd_p_fu4 ~~ 1*petd_p_fu4; pete_p_fu4 ~~ 1*pete_p_fu4
peta_p_fu5 ~~ 1*peta_p_fu5; petb_p_fu5 ~~ 1*petb_p_fu5; petc_p_fu5 ~~ 1*petc_p_fu5; petd_p_fu5 ~~ 1*petd_p_fu5; pete_p_fu5 ~~ 1*pete_p_fu5
peta_p_fu6 ~~ 1*peta_p_fu6; petb_p_fu6 ~~ 1*petb_p_fu6; petc_p_fu6 ~~ 1*petc_p_fu6; petd_p_fu6 ~~ 1*petd_p_fu6; pete_p_fu6 ~~ 1*pete_p_fu6
'
# run the configural model
fit_config_p_f <- cfa(
model_parent_config,
data = merged_wide_f,
parameterization = "theta",
ordered = ordered_vars_list,
std.lv = TRUE
)
# run the configural model
fit_config_p_f <- cfa(
model_parent_config,
data = merged_wide_f,
parameterization = "theta",
missing = "pairwise",
ordered = ordered_vars_list,
std.lv = TRUE
)
model_parent_weak <- '
# factor loadings (constrained with labels l2-l5)
puberty_bl =~ 1*peta_p_bl + l2*petb_p_bl + l3*petc_p_bl + l4*petd_p_bl + l5*pete_p_bl
puberty_fu1 =~ 1*peta_p_fu1 + l2*petb_p_fu1 + l3*petc_p_fu1 + l4*petd_p_fu1 + l5*pete_p_fu1
puberty_fu2 =~ 1*peta_p_fu2 + l2*petb_p_fu2 + l3*petc_p_fu2 + l4*petd_p_fu2 + l5*pete_p_fu2
puberty_fu3 =~ 1*peta_p_fu3 + l2*petb_p_fu3 + l3*petc_p_fu3 + l4*petd_p_fu3 + l5*pete_p_fu3
puberty_fu4 =~ 1*peta_p_fu4 + l2*petb_p_fu4 + l3*petc_p_fu4 + l4*petd_p_fu4 + l5*pete_p_fu4
puberty_fu5 =~ 1*peta_p_fu5 + l2*petb_p_fu5 + l3*petc_p_fu5 + l4*petd_p_fu5 + l5*pete_p_fu5
puberty_fu6 =~ 1*peta_p_fu6 + l2*petb_p_fu6 + l3*petc_p_fu6 + l4*petd_p_fu6 + l5*pete_p_fu6
# all covariances, intercepts, and residual variances are identical to the configural model
puberty_bl ~~ puberty_bl
puberty_fu1 ~~ puberty_fu1
puberty_fu2 ~~ puberty_fu2
puberty_fu3 ~~ puberty_fu3
puberty_fu4 ~~ puberty_fu4
puberty_fu5 ~~ puberty_fu5
puberty_fu6 ~~ puberty_fu6
puberty_bl ~~ puberty_fu1 + puberty_fu2 + puberty_fu3 + puberty_fu4 + puberty_fu5 + puberty_fu6
puberty_fu1 ~~ puberty_fu2 + puberty_fu3 + puberty_fu4 + puberty_fu5 + puberty_fu6
puberty_fu2 ~~ puberty_fu3 + puberty_fu4 + puberty_fu5 + puberty_fu6
puberty_fu3 ~~ puberty_fu4 + puberty_fu5 + puberty_fu6
puberty_fu4 ~~ puberty_fu5 + puberty_fu6
puberty_fu5 ~~ puberty_fu6
puberty_bl  ~ 0*1
puberty_fu1 ~ 0*1
puberty_fu2 ~ 0*1
puberty_fu3 ~ 0*1
puberty_fu4 ~ 0*1
puberty_fu5 ~ 0*1
puberty_fu6 ~ 0*1
peta_p_bl ~~ 1*peta_p_bl; petb_p_bl ~~ 1*petb_p_bl; petc_p_bl ~~ 1*petc_p_bl; petd_p_bl ~~ 1*petd_p_bl; pete_p_bl ~~ 1*pete_p_bl
peta_p_fu1 ~~ 1*peta_p_fu1; petb_p_fu1 ~~ 1*petb_p_fu1; petc_p_fu1 ~~ 1*petc_p_fu1; petd_p_fu1 ~~ 1*petd_p_fu1; pete_p_fu1 ~~ 1*pete_p_fu1
peta_p_fu2 ~~ 1*peta_p_fu2; petb_p_fu2 ~~ 1*petb_p_fu2; petc_p_fu2 ~~ 1*petc_p_fu2; petd_p_fu2 ~~ 1*petd_p_fu2; pete_p_fu2 ~~ 1*pete_p_fu2
peta_p_fu3 ~~ 1*peta_p_fu3; petb_p_fu3 ~~ 1*petb_p_fu3; petc_p_fu3 ~~ 1*petc_p_fu3; petd_p_fu3 ~~ 1*petd_p_fu3; pete_p_fu3 ~~ 1*pete_p_fu3
peta_p_fu4 ~~ 1*peta_p_fu4; petb_p_fu4 ~~ 1*petb_p_fu4; petc_p_fu4 ~~ 1*petc_p_fu4; petd_p_fu4 ~~ 1*petd_p_fu4; pete_p_fu4 ~~ 1*pete_p_fu4
peta_p_fu5 ~~ 1*peta_p_fu5; petb_p_fu5 ~~ 1*petb_p_fu5; petc_p_fu5 ~~ 1*petc_p_fu5; petd_p_fu5 ~~ 1*petd_p_fu5; pete_p_fu5 ~~ 1*pete_p_fu5
peta_p_fu6 ~~ 1*peta_p_fu6; petb_p_fu6 ~~ 1*petb_p_fu6; petc_p_fu6 ~~ 1*petc_p_fu6; petd_p_fu6 ~~ 1*petd_p_fu6; pete_p_fu6 ~~ 1*pete_p_fu6
'
# run the weak model
fit_weak_p_f <- cfa(
model_parent_weak,
data = merged_wide_f,
parameterization = "theta",
ordered = ordered_vars_list,
missing = "pairwise",
std.lv = TRUE
)
model_parent_strong_partial <- '
# 1. factor loadings (constrained with labels l2-l5)
puberty_bl =~ 1*peta_p_bl + l2*petb_p_bl + l3*petc_p_bl + l4*petd_p_bl + l5*pete_p_bl
puberty_fu1 =~ 1*peta_p_fu1 + l2*petb_p_fu1 + l3*petc_p_fu1 + l4*petd_p_fu1 + l5*pete_p_fu1
puberty_fu2 =~ 1*peta_p_fu2 + l2*petb_p_fu2 + l3*petc_p_fu2 + l4*petd_p_fu2 + l5*pete_p_fu2
puberty_fu3 =~ 1*peta_p_fu3 + l2*petb_p_fu3 + l3*petc_p_fu3 + l4*petd_p_fu3 + l5*pete_p_fu3
puberty_fu4 =~ 1*peta_p_fu4 + l2*petb_p_fu4 + l3*petc_p_fu4 + l4*petd_p_fu4 + l5*pete_p_fu4
puberty_fu5 =~ 1*peta_p_fu5 + l2*petb_p_fu5 + l3*petc_p_fu5 + l4*petd_p_fu5 + l5*pete_p_fu5
puberty_fu6 =~ 1*peta_p_fu6 + l2*petb_p_fu6 + l3*petc_p_fu6 + l4*petd_p_fu6 + l5*pete_p_fu6
# 2. all covariances, intercepts, and residual variances (identical to configural)
puberty_bl ~~ puberty_bl
puberty_fu1 ~~ puberty_fu1
puberty_fu2 ~~ puberty_fu2
puberty_fu3 ~~ puberty_fu3
puberty_fu4 ~~ puberty_fu4
puberty_fu5 ~~ puberty_fu5
puberty_fu6 ~~ puberty_fu6
puberty_bl ~~ puberty_fu1 + puberty_fu2 + puberty_fu3 + puberty_fu4 + puberty_fu5 + puberty_fu6
puberty_fu1 ~~ puberty_fu2 + puberty_fu3 + puberty_fu4 + puberty_fu5 + puberty_fu6
puberty_fu2 ~~ puberty_fu3 + puberty_fu4 + puberty_fu5 + puberty_fu6
puberty_fu3 ~~ puberty_fu4 + puberty_fu5 + puberty_fu6
puberty_fu4 ~~ puberty_fu5 + puberty_fu6
puberty_fu5 ~~ puberty_fu6
puberty_bl  ~ 0*1
puberty_fu1 ~ 0*1
puberty_fu2 ~ 0*1
puberty_fu3 ~ 0*1
puberty_fu4 ~ 0*1
puberty_fu5 ~ 0*1
puberty_fu6 ~ 0*1
peta_p_bl ~~ 1*peta_p_bl; petb_p_bl ~~ 1*petb_p_bl; petc_p_bl ~~ 1*petc_p_bl; petd_p_bl ~~ 1*petd_p_bl; pete_p_bl ~~ 1*pete_p_bl
peta_p_fu1 ~~ 1*peta_p_fu1; petb_p_fu1 ~~ 1*petb_p_fu1; petc_p_fu1 ~~ 1*petc_p_fu1; petd_p_fu1 ~~ 1*petd_p_fu1; pete_p_fu1 ~~ 1*pete_p_fu1
peta_p_fu2 ~~ 1*peta_p_fu2; petb_p_fu2 ~~ 1*petb_p_fu2; petc_p_fu2 ~~ 1*petc_p_fu2; petd_p_fu2 ~~ 1*petd_p_fu2; pete_p_fu2 ~~ 1*pete_p_fu2
peta_p_fu3 ~~ 1*peta_p_fu3; petb_p_fu3 ~~ 1*petb_p_fu3; petc_p_fu3 ~~ 1*petc_p_fu3; petd_p_fu3 ~~ 1*petd_p_fu3; pete_p_fu3 ~~ 1*pete_p_fu3
peta_p_fu4 ~~ 1*peta_p_fu4; petb_p_fu4 ~~ 1*petb_p_fu4; petc_p_fu4 ~~ 1*petc_p_fu4; petd_p_fu4 ~~ 1*petd_p_fu4; pete_p_fu4 ~~ 1*pete_p_fu4
peta_p_fu5 ~~ 1*peta_p_fu5; petb_p_fu5 ~~ 1*petb_p_fu5; petc_p_fu5 ~~ 1*petc_p_fu5; petd_p_fu5 ~~ 1*petd_p_fu5; pete_p_fu5 ~~ 1*pete_p_fu5
peta_p_fu6 ~~ 1*peta_p_fu6; petb_p_fu6 ~~ 1*petb_p_fu6; petc_p_fu6 ~~ 1*petc_p_fu6; petd_p_fu6 ~~ 1*petd_p_fu6; pete_p_fu6 ~~ 1*pete_p_fu6
# 3. add threshold constraints for items a, b, c
# (assuming they all have 3 thresholds, i.e., 4 categories)
peta_p_bl  | t_a1 + t_a2 + t_a3
peta_p_fu1 | t_a1 + t_a2 + t_a3
peta_p_fu2 | t_a1 + t_a2 + t_a3
peta_p_fu3 | t_a1 + t_a2 + t_a3
peta_p_fu4 | t_a1 + t_a2 + t_a3
peta_p_fu5 | t_a1 + t_a2 + t_a3
peta_p_fu6 | t_a1 + t_a2 + t_a3
petb_p_bl  | t_b1 + t_b2 + t_b3
petb_p_fu1 | t_b1 + t_b2 + t_b3
petb_p_fu2 | t_b1 + t_b2 + t_b3
petb_p_fu3 | t_b1 + t_b2 + t_b3
petb_p_fu4 | t_b1 + t_b2 + t_b3
petb_p_fu5 | t_b1 + t_b2 + t_b3
petb_p_fu6 | t_b1 + t_b2 + t_b3
petc_p_bl  | t_c1 + t_c2 + t_c3
petc_p_fu1 | t_c1 + t_c2 + t_c3
petc_p_fu2 | t_c1 + t_c2 + t_c3
petc_p_fu3 | t_c1 + t_c2 + t_c3
petc_p_fu4 | t_c1 + t_c2 + t_c3
petc_p_fu5 | t_c1 + t_c2 + t_c3
petc_p_fu6 | t_c1 + t_c2 + t_c3
# thresholds for petd and pete are left free (not mentioned)
'
# run the strong partial model
fit_strong_p_f <- cfa(
model_parent_strong_partial,
data = merged_wide_f,
parameterization = "theta",
ordered = ordered_vars_list,
missing = "pairwise",
std.lv = TRUE
)
# run the strong partial model
fit_strong_p_f <- cfa(
model_parent_strong_partial,
data = merged_wide_f,
parameterization = "theta",
ordered = ordered_vars_list,
missing = "pairwise",
representation = "RAM",  # <-- add this line
std.lv = TRUE
)
# run the strong partial model
fit_strong_p_f <- cfa(
model_parent_strong_partial,
data = merged_wide_f,
parameterization = "theta",
ordered = ordered_vars_list,
missing = "pairwise"
)
model_parent_strong_partial <- '
# 1. factor loadings (constrained with labels l2-l5)
puberty_bl =~ 1*peta_p_bl + l2*petb_p_bl + l3*petc_p_bl + l4*petd_p_bl + l5*pete_p_bl
puberty_fu1 =~ 1*peta_p_fu1 + l2*petb_p_fu1 + l3*petc_p_fu1 + l4*petd_p_fu1 + l5*pete_p_fu1
puberty_fu2 =~ 1*peta_p_fu2 + l2*petb_p_fu2 + l3*petc_p_fu2 + l4*petd_p_fu2 + l5*pete_p_fu2
puberty_fu3 =~ 1*peta_p_fu3 + l2*petb_p_fu3 + l3*petc_p_fu3 + l4*petd_p_fu3 + l5*pete_p_fu3
puberty_fu4 =~ 1*peta_p_fu4 + l2*petb_p_fu4 + l3*petc_p_fu4 + l4*petd_p_fu4 + l5*pete_p_fu4
puberty_fu5 =~ 1*peta_p_fu5 + l2*petb_p_fu5 + l3*petc_p_fu5 + l4*petd_p_fu5 + l5*pete_p_fu5
puberty_fu6 =~ 1*peta_p_fu6 + l2*petb_p_fu6 + l3*petc_p_fu6 + l4*petd_p_fu6 + l5*pete_p_fu6
# 2. all covariances, intercepts, and residual variances (identical to configural)
puberty_bl ~~ puberty_bl
puberty_fu1 ~~ puberty_fu1
puberty_fu2 ~~ puberty_fu2
puberty_fu3 ~~ puberty_fu3
puberty_fu4 ~~ puberty_fu4
puberty_fu5 ~~ puberty_fu5
puberty_fu6 ~~ puberty_fu6
puberty_bl ~~ puberty_fu1 + puberty_fu2 + puberty_fu3 + puberty_fu4 + puberty_fu5 + puberty_fu6
puberty_fu1 ~~ puberty_fu2 + puberty_fu3 + puberty_fu4 + puberty_fu5 + puberty_fu6
puberty_fu2 ~~ puberty_fu3 + puberty_fu4 + puberty_fu5 + puberty_fu6
puberty_fu3 ~~ puberty_fu4 + puberty_fu5 + puberty_fu6
puberty_fu4 ~~ puberty_fu5 + puberty_fu6
puberty_fu5 ~~ puberty_fu6
puberty_bl  ~ 0*1
puberty_fu1 ~ 0*1
puberty_fu2 ~ 0*1
puberty_fu3 ~ 0*1
puberty_fu4 ~ 0*1
puberty_fu5 ~ 0*1
puberty_fu6 ~ 0*1
peta_p_bl ~~ 1*peta_p_bl; petb_p_bl ~~ 1*petb_p_bl; petc_p_bl ~~ 1*petc_p_bl; petd_p_bl ~~ 1*petd_p_bl; pete_p_bl ~~ 1*pete_p_bl
peta_p_fu1 ~~ 1*peta_p_fu1; petb_p_fu1 ~~ 1*petb_p_fu1; petc_p_fu1 ~~ 1*petc_p_fu1; petd_p_fu1 ~~ 1*petd_p_fu1; pete_p_fu1 ~~ 1*pete_p_fu1
peta_p_fu2 ~~ 1*peta_p_fu2; petb_p_fu2 ~~ 1*petb_p_fu2; petc_p_fu2 ~~ 1*petc_p_fu2; petd_p_fu2 ~~ 1*petd_p_fu2; pete_p_fu2 ~~ 1*pete_p_fu2
peta_p_fu3 ~~ 1*peta_p_fu3; petb_p_fu3 ~~ 1*petb_p_fu3; petc_p_fu3 ~~ 1*petc_p_fu3; petd_p_fu3 ~~ 1*petd_p_fu3; pete_p_fu3 ~~ 1*pete_p_fu3
peta_p_fu4 ~~ 1*peta_p_fu4; petb_p_fu4 ~~ 1*petb_p_fu4; petc_p_fu4 ~~ 1*petc_p_fu4; petd_p_fu4 ~~ 1*petd_p_fu4; pete_p_fu4 ~~ 1*pete_p_fu4
peta_p_fu5 ~~ 1*peta_p_fu5; petb_p_fu5 ~~ 1*petb_p_fu5; petc_p_fu5 ~~ 1*petc_p_fu5; petd_p_fu5 ~~ 1*petd_p_fu5; pete_p_fu5 ~~ 1*pete_p_fu5
peta_p_fu6 ~~ 1*peta_p_fu6; petb_p_fu6 ~~ 1*petb_p_fu6; petc_p_fu6 ~~ 1*petc_p_fu6; petd_p_fu6 ~~ 1*petd_p_fu6; pete_p_fu6 ~~ 1*pete_p_fu6
# 3. add threshold constraints for items a, b, c
# (assuming they all have 3 thresholds, i.e., 4 categories)
peta_p_bl  | tau_a1*t_a1 + tau_a2*t_a2 + tau_a3*t_a3
peta_p_fu1 | tau_a1*t_a1 + tau_a2*t_a2 + tau_a3*t_a3
peta_p_fu2 | tau_a1*t_a1 + tau_a2*t_a2 + tau_a3*t_a3
peta_p_fu3 | tau_a1*t_a1 + tau_a2*t_a2 + tau_a3*t_a3
peta_p_fu4 | tau_a1*t_a1 + tau_a2*t_a2 + tau_a3*t_a3
peta_p_fu5 | tau_a1*t_a1 + tau_a2*t_a2 + tau_a3*t_a3
peta_p_fu6 | tau_a1*t_a1 + tau_a2*t_a2 + tau_a3*t_a3
petb_p_bl  | tau_b1*t_b1 + tau_b2*t_b2 + tau_b3*t_b3
petb_p_fu1 | tau_b1*t_b1 + tau_b2*t_b2 + tau_b3*t_b3
petb_p_fu2 | tau_b1*t_b1 + tau_b2*t_b2 + tau_b3*t_b3
petb_p_fu3 | tau_b1*t_b1 + tau_b2*t_b2 + tau_b3*t_b3
petb_p_fu4 | tau_b1*t_b1 + tau_b2*t_b2 + tau_b3*t_b3
petb_p_fu5 | tau_b1*t_b1 + tau_b2*t_b2 + tau_b3*t_b3
petb_p_fu6 | tau_b1*t_b1 + tau_b2*t_b2 + tau_b3*t_b3
petc_p_bl  | tau_c1*t_c1 + tau_c2*t_c2 + tau_c3*t_c3
petc_p_fu1 | tau_c1*t_c1 + tau_c2*t_c2 + tau_c3*t_c3
petc_p_fu2 | tau_c1*t_c1 + tau_c2*t_c2 + tau_c3*t_c3
petc_p_fu3 | tau_c1*t_c1 + tau_c2*t_c2 + tau_c3*t_c3
petc_p_fu4 | tau_c1*t_c1 + tau_c2*t_c2 + tau_c3*t_c3
petc_p_fu5 | tau_c1*t_c1 + tau_c2*t_c2 + tau_c3*t_c3
petc_p_fu6 | tau_c1*t_c1 + tau_c2*t_c2 + tau_c3*t_c3
'
# run the strong partial model
fit_strong_p_f <- cfa(
model_parent_strong_partial,
data = merged_wide_f,
parameterization = "theta",
ordered = ordered_vars_list,
missing = "pairwise"
)
config <- measEq.syntax(
configural.model = mod,
data = subset(merged_both, sex == 1),
group = "wave",
parameterization = "theta",
identification = "configural"
)
mod <- '
pub =~ peta_p + petb_p + petc_p + petd_p + pete_p
'
config <- measEq.syntax(
configural.model = mod,
data = subset(merged_both, sex == 1),
group = "wave",
parameterization = "theta",
identification = "configural"
)
config <- measEq.syntax(
configural.model = mod,
data = subset(merged_both, sex == 1),
group = "wave",
parameterization = "theta")
fit_cfg <- cfa(
config,
data = subset(merged_both, sex == 1),
group = "wave",
ordered = ordered_items,
estimator = "WLSMV",
parameterization = "theta",
std.lv = TRUE
)
knitr::opts_chunk$set(
echo = TRUE,
message = TRUE,
warning = TRUE
)
options(scipen=999)
library(pacman)
pacman::p_load(dplyr, ggplot2, tidyr, stringr, lubridate, psych, nlme, MuMIn, purrr, readr, install = TRUE)
proj_root = "/Users/clarefmccann/University\ of\ Oregon\ Dropbox/Clare\ McCann/mine/projects/abcd-projs/puberty/"
data_root = "/Users/clarefmccann/University\ of\ Oregon\ Dropbox/Clare\ McCann/mine/projects/abcd-projs/abcd-data-release-6.0/"
out_dir <- "/Users/clarefmccann/University of Oregon Dropbox/Clare McCann/mine/projects/abcd-projs/puberty/pub_exp_output/visualizations/6.0/"
dir.create(out_dir, showWarnings = FALSE, recursive = TRUE)
wave_levels <- c("ses-00A","ses-01A","ses-02A","ses-03A","ses-04A","ses-05A","ses-06A")
wave_labels <- c("ses-00A"="BL","ses-01A"="FU1","ses-02A"="FU2","ses-03A"="FU3","ses-04A"="FU4","ses-05A"="FU5","ses-06A"="FU6")
# keep the plot theme boring to avoid font shenanigans
theme_set(theme_minimal(base_size = 11))
# device safety net
safe_save <- function(plot, filename, width, height, dpi = 300) {
tryCatch(
ggsave(filename = filename, plot = plot, width = width, height = height, dpi = dpi, device = "png"),
error = function(e) {
message("ggsave failed for ", filename, " (", conditionMessage(e), "). retrying via png()...")
grDevices::png(filename = filename, width = width, height = height, units = "in", res = dpi)
print(plot)
grDevices::dev.off()
}
)
}
# ------------------------------------------------------------
# core function
# ------------------------------------------------------------
generate_visualizations <- function(df, label, sex, out_dir) {
stopifnot(all(c("id","wave","PDSS") %in% names(df)))
plot_color_sex <- if (sex == "f") "#B0413E" else "#0072B2"
informant <- dplyr::case_when(
stringr::str_detect(label, "_p$") ~ "parent",
stringr::str_detect(label, "_y$") ~ "youth",
TRUE ~ "unknown"
)
plot_color_reporter <- dplyr::case_when(
informant == "parent" ~ "grey20",
informant == "youth"  ~ "#FCAA67", # orange
TRUE                  ~ "grey20"    # a default fallback
)
dat <- df %>%
mutate(
wave = factor(wave, levels = wave_levels, ordered = TRUE),
wave_short = dplyr::recode(as.character(wave), !!!wave_labels, .default = as.character(wave))
) %>%
filter(is.finite(PDSS), is.finite(age), !is.na(wave))
# 1) means by wave with n labels
means_wave <- dat %>%
group_by(wave, wave_short) %>%
summarise(
mean_pdss = mean(PDSS),
sd_pdss   = sd(PDSS),
n         = dplyr::n(),
.groups = "drop"
)
p_means_wave <- ggplot(means_wave, aes(x = wave, y = mean_pdss, group = 1)) +
geom_line(color = plot_color_sex) +
geom_point(color = plot_color_sex) +
geom_text(aes(label = paste0("n=", n)), vjust = -0.8, size = 3) +
coord_cartesian(ylim = c(1, 5)) +
labs(
x = "Time Point",
y = "Mean Pubertal Stage",
title = paste0("Mean Pubertal Stage Across TP (", sex, ", ", informant, ")")
)
safe_save(p_means_wave, file.path(out_dir, paste0(label, "_means_by_wave_filtered.png")), 7, 4)
# 2) distribution by wave
p_box_wave <- ggplot(dat, aes(x = wave, y = PDSS)) +
geom_boxplot(fill = plot_color_sex, outlier.shape = NA, alpha = 0.6) + # use fill for boxes
geom_jitter(color = plot_color_sex, width = 0.15, alpha = 0.15, size = 0.7) +
coord_cartesian(ylim = c(1, 5)) +
labs(
x = "Time Point",
y = "Pubertal Stage",
title = paste0("Pubertal Stage Distribution by TP (", sex, ", ", informant, ")")
)
safe_save(p_box_wave, file.path(out_dir, paste0(label, "_box_by_wave_filtered.png")), 7.5, 4.5)
# 3) connected trajectories across age + GAM
p_spaghetti <- ggplot(dat, aes(x = age, y = PDSS, group = id)) +
#geom_line(alpha = 0.22, linewidth = 0.4, color = plot_color_sex) + # color for lines
#geom_point(alpha = 0.18, size = 0.8, color = plot_color_sex) +    # color for points
geom_smooth(aes(group = 1), # override the grouping for this layer only
method = "gam",
formula = y ~ s(x, k = 10),
se = TRUE,
color = plot_color_reporter,
fill = plot_color_reporter,
alpha = 0.2
) + #
coord_cartesian(ylim = c(1, 5)) +
labs(
x = "Age (years)",
y = "Pubertal Stage",
title = paste0("Pubertal Stage Across Age with Individual Trajectories (", sex, ", ", informant, ")")
)
safe_save(p_spaghetti, file.path(out_dir, paste0(label, "_age_spaghetti_gam_filtered_onlyline.png")), 7.5, 4.5)
# 4) observation counts per participant
obs_distribution <- dat %>%
count(id, name = "observations") %>%
count(observations, name = "participants_count") %>%
arrange(observations)
p_obs <- ggplot(obs_distribution, aes(x = factor(observations), y = participants_count)) +
geom_col(fill = plot_color_sex) +
labs(
x = "Observations Per Participant",
y = "Participants",
title = paste0("Observation Counts (", sex, ", ", informant, ")")
)
safe_save(p_obs, file.path(out_dir, paste0(label, "_obs_per_participant_filtered.png")), 6.5, 4)
write_csv(means_wave, file.path(out_dir, paste0("filtered_summary_means_by_wave_", label, ".csv")))
write_csv(obs_distribution, file.path(out_dir, paste0("filtered_summary_obs_per_participant_", label, ".csv")))
invisible(list(means_wave = means_wave, obs_distribution = obs_distribution))
}
# ------------------------------------------------------------
# read data and run (unchanged shape)
# ------------------------------------------------------------
datasets <- list(
pds_m_p = list(df = read.csv(paste0(data_root, "physical-health/puberty/filtered_parent_tannerstages_m.csv")), sex = "m"),
pds_f_p = list(df = read.csv(paste0(data_root, "physical-health/puberty/filtered_parent_tannerstages_f.csv")), sex = "f"),
pds_m_y = list(df = read.csv(paste0(data_root, "physical-health/puberty/filtered_youth_tannerstages_m.csv")), sex = "m"),
pds_f_y = list(df = read.csv(paste0(data_root, "physical-health/puberty/filtered_youth_tannerstages_f.csv")), sex = "f")
)
visualization_results <- purrr::imap(
datasets,
~ {
suffix <- sub("^pds_", "", .y)
generate_visualizations(df = .x$df, label = .y, sex = .x$sex, out_dir = out_dir)
}
)
